<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/css" rel="stylesheet" href="Front End/css/maze_runner.css" />

    <!-- BootStrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


    <title>CSE 110 Maze Runner</title>
    <script src="JS/Game.js"></script>
	<script src="JS/JSInter/acorn.js"></script>
    <script src="JS/JSInter/interpreter.js"></script>
    <script src="Blockly/blockly_compressed.js"></script>
    <script src="Blockly/javascript_compressed.js"></script>
    <script src="Blockly/blocks_compressed.js"></script>
    <script src="Blockly/blocks/testBlockJSON.js"></script>
    <script src="Blockly/generators/javascript/testblockgen.js"></script>
    <script src="Blockly/msg/js/en.js"></script>
    <script src="map.js"></script>
    <script src="GameEngine.js"></script>
    <script src="ChangeHandler.js"></script>
	

  </head>
  <body>
    <header id="header">
      <div class="header_inner">
        <h1 class="header_title">Maze Runner</h1>
      </div>
    </header>
		
		<div id="mr-scores">
			<ul>
				<li><strong>High Score: </strong><span id="mr-highScore">0</span></li>
				<li><strong>Game Score: </strong><span id="mr-gameScore">0</span></li>
				<li><strong>Level Score: </strong><span id="mr-levelScore">0</span></li>
				<li><strong>Level: </strong><span id="mr-levelNumber">1</span></li>
			</ul>
		</div>
		
		
		<div id="mr-game-container">
			<div id="mr-gameArea">
				<div id="GameArea"> </div>
			</div>
			<div id="mr-controls">
				<strong>While battery not found.. do:</strong>
				<div id="blocklyDiv" style="height: 500px; width: 100%;"></div>
			</div>
		</div>
	
	
		<nav id="mr-navigation">
			<ul>
				<li><button class="btn btn-primary" id="mr-play" onclick="GAME_ENGINE.play();">Play</button></li>
				<li><button class="btn btn-primary" id="mr-pause" onclick="GAME_ENGINE.pause();">Pause</button></li>
				<li><button class="btn btn-primary" id="mr-step" onclick="GAME_ENGINE.step();">Step</button></li>
				<li><button class="btn btn-link" id="mr-help" data-toggle="modal" data-target="#mr-helpModal">help</button></li>
				<li><button class="btn btn-primary" id="mr-resetLevel" onclick="GAME_ENGINE.resetLevel();">Reset Level</button></li>
				<li><button class="btn btn-primary" id="mr-resetGame" onclick="loacation.reload();">Reset Game</button></li>
			</ul>
		</nav>
	
      <!-- Modal -->
      <div class="modal fade" id="mr-helpModal" tabindex="-1" role="dialog" aria-labelledby="mr-helpModalLongTitle" aria-hidden="true">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="mr-helpModalLongTitle">Maze Runner Help</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      <div>
                          <h5>Welcome</h5>
                          <p>The Maze Runner's battery is running out. He needs your help to find the battery and recharge. Help him navigate through the maze to reach the battery.</p>
                      </div>
                      <div class="mr-helpDiv clearfix">
                          <h5>Maze Runner Robot</h5>
                          <img class="float-left" src="images/ship_east.png" width="50px" alt="robot" />
                          <p>I'm the maze runner. help me recharge my batteries</p>
                      </div>
                      <div class="mr-helpDiv clearfix">
                          <h5>Battery</h5>
                          <img class="float-left" src="images/tmpBattery.png" width="50px" alt="robot" />
                          <p>The battery is what you are trying to get.</p>
                      </div>
                      <div class="mr-helpDiv clearfix">
                          <h5>Step</h5>
                          <img class="float-left" src="images/step_button.png" width="50px" alt="robot" />
                          <p>Go through each action step by step.</p>
                      </div>
                    <div></div>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  </div>
              </div>
          </div>
      </div>
	
	  <!-- blockly code -->
	  <xml id="toolbox" style="display: none">
      <category name="Logic">
        <block type="open_right"></block>	
        <block type="open_left"></block>
        <block type="open_front"></block>
        <block type="open_back"></block>
        <block type="outer_if"></block>
        <block type="wall_right"></block>	
        <block type="wall_left"></block>
        <block type="wall_front"></block>
        <block type="wall_back"></block>
      </category>
      <category name="Statements">
        <block type="back_statement"></block>
        <block type="forward_statement"></block>
        <block type="left_statement"></block>
        <block type="right_statement"></block>
      </category>
    </xml>

    <!---DEFULAT BLOCKS---->
    <xml xmlns="http://www.w3.org/1999/xhtml" id="workspaceBlocks" style="display:none">
      <variables></variables>
      <block type="outer_if" id="!5.J#s[UIoH)?ERLqgdk" x="38" y="13">
        <value name="Condition">
          <block type="open_front" id="]=w0r1dlM_u*en;*$|?{">
          </block>
        </value>
        <statement name="Name">
          <block type="forward_statement" id="JeqO%A=C`q-iteljzcye">
            <next>
              <block type="right_statement" id="JeqO%A=C`q-iteljzcyf">
                <next>
                  <block type="right_statement" id="JeqO%A=C`q-iteljzcyh">
                  </block>
                </next>
              </block>
            </next>
          </block>
          
        </statement>
        <next>
          <block type="left_statement" id="JeqO%A=C`q-iteljzcyg">
        
          </block>
        </next>
      </block>
    </xml>
    <!--END DEFAULT BLOCKS-->

    <script type="application/javascript">
      
      GAME_ENGINE = new GameEngine(true);
      
      //load the tool box description from the above XML
      var toolbox = document.getElementById("toolbox");
      
      //define the blockly options
      var options = 
      { 
        toolbox : toolbox, 
        collapse : true, 
        comments : true, 
        disable : true, 
        maxBlocks : Infinity, 
        trashcan : true, 
        horizontalLayout : false, 
        toolboxPosition : 'bottom', 
        css : true, 
        media : 'https://blockly-demo.appspot.com/static/media/', 
        rtl : false, 
        scrollbars : true, 
        sounds : false, 
        oneBasedIndex : true, 
        grid : 
        {
          spacing : 20, 
          length : 1, 
          colour : '#888', 
          snap : true
        }
      };
      
      //inject the blockly canvas into the blocklyDiv
      var demoWorkspace = Blockly.inject('blocklyDiv',
        {
          media: 'Blockly/media/',
          toolbox: document.getElementById('toolbox')
        }
      );
        
      //variable defining the default blocks to load on start up.
      var workspaceBlocks = document.getElementById("workspaceBlocks"); 

      /* Load blocks to workspace. */
      Blockly.Xml.domToWorkspace(demoWorkspace, workspaceBlocks);
      
      //generate the code for the first time
      GAME_ENGINE.generateCodeAndLoadIntoInterpreter();
      
      //Change listener for the workspace
      demoWorkspace.addChangeListener(function(event) 
        {
          if (!(event instanceof Blockly.Events.Ui)) 
          {
            //pass it to another object to handle changes
            GAME_ENGINE.blocklyChangeHandler.handleChanges(event, demoWorkspace);
            
            //generate code from the recently changed blockly workspace
            GAME_ENGINE.generateCodeAndLoadIntoInterpreter();
            
            //dump the current instance of the interpreter. This guarantees that code execution will start that the beginning
            GAME_ENGINE.removeInterpreter();
          }
        }
      );
      </script>

      <div id="GameArea"> </div>

      <footer>
      </footer>
    </main>
  </body>
</html>
